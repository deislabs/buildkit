#!/usr/bin/env bash

. $(dirname $0)/util
set -eu

: ${TARGETPLATFORM=}
: ${CONTINUOUS_INTEGRATION=}

platformFlag=""
if [ -n "$TARGETPLATFORM" ]; then
  platformFlag="--platform $TARGETPLATFORM"
fi

set -x

docker buildx build $progressFlag $platformFlag \
  --target binaries \
  --output "type=local,dest=./bin/" \
  --file ./hack/dockerfiles/shfmt.Dockerfile \
  .
